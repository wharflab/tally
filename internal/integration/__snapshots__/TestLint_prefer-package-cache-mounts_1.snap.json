{
  "files": [
    {
      "file": "testdata/prefer-package-cache-mounts/Dockerfile",
      "violations": [
        {
          "detail": "Detected package install/build command; add cache mount(s): /root/.npm",
          "docUrl": "https://github.com/wharflab/tally/blob/main/docs/rules/tally/prefer-package-cache-mounts.md",
          "location": {
            "end": {
              "column": 0,
              "line": 3
            },
            "file": "testdata/prefer-package-cache-mounts/Dockerfile",
            "start": {
              "column": 0,
              "line": 3
            }
          },
          "message": "use cache mounts for package manager cache directories",
          "rule": "tally/prefer-package-cache-mounts",
          "severity": "info",
          "sourceCode": "RUN npm install \u0026\u0026 npm cache clean --force",
          "suggestedFix": {
            "description": "Add package cache mount(s) and remove cache cleanup commands",
            "edits": [
              {
                "location": {
                  "end": {
                    "column": 42,
                    "line": 3
                  },
                  "file": "testdata/prefer-package-cache-mounts/Dockerfile",
                  "start": {
                    "column": 0,
                    "line": 3
                  }
                },
                "newText": "RUN --mount=type=cache,target=/root/.npm npm install"
              }
            ],
            "priority": 90,
            "safety": 1
          }
        },
        {
          "detail": "Detected package install/build command; add cache mount(s): /go/pkg/mod, /root/.cache/go-build",
          "docUrl": "https://github.com/wharflab/tally/blob/main/docs/rules/tally/prefer-package-cache-mounts.md",
          "location": {
            "end": {
              "column": 0,
              "line": 4
            },
            "file": "testdata/prefer-package-cache-mounts/Dockerfile",
            "start": {
              "column": 0,
              "line": 4
            }
          },
          "message": "use cache mounts for package manager cache directories",
          "rule": "tally/prefer-package-cache-mounts",
          "severity": "info",
          "sourceCode": "RUN go build ./...",
          "suggestedFix": {
            "description": "Add package cache mount(s)",
            "edits": [
              {
                "location": {
                  "end": {
                    "column": 18,
                    "line": 4
                  },
                  "file": "testdata/prefer-package-cache-mounts/Dockerfile",
                  "start": {
                    "column": 0,
                    "line": 4
                  }
                },
                "newText": "RUN --mount=type=cache,target=/go/pkg/mod --mount=type=cache,target=/root/.cache/go-build go build ./..."
              }
            ],
            "priority": 90,
            "safety": 1
          }
        },
        {
          "detail": "Detected package install/build command; add cache mount(s): /var/cache/apt (sharing=locked), /var/lib/apt (sharing=locked)",
          "docUrl": "https://github.com/wharflab/tally/blob/main/docs/rules/tally/prefer-package-cache-mounts.md",
          "location": {
            "end": {
              "column": 0,
              "line": 5
            },
            "file": "testdata/prefer-package-cache-mounts/Dockerfile",
            "start": {
              "column": 0,
              "line": 5
            }
          },
          "message": "use cache mounts for package manager cache directories",
          "rule": "tally/prefer-package-cache-mounts",
          "severity": "info",
          "sourceCode": "RUN --mount=type=secret,id=aptcfg,target=/etc/apt/auth.conf \\",
          "suggestedFix": {
            "description": "Add package cache mount(s) and remove cache cleanup commands",
            "edits": [
              {
                "location": {
                  "end": {
                    "column": 61,
                    "line": 7
                  },
                  "file": "testdata/prefer-package-cache-mounts/Dockerfile",
                  "start": {
                    "column": 0,
                    "line": 5
                  }
                },
                "newText": "RUN --mount=type=secret,id=aptcfg,target=/etc/apt/auth.conf --mount=type=cache,target=/var/cache/apt,sharing=locked --mount=type=cache,target=/var/lib/apt,sharing=locked apt-get update \u0026\u0026 apt-get install -y gcc"
              }
            ],
            "priority": 90,
            "safety": 1
          }
        },
        {
          "detail": "Detected package install/build command; add cache mount(s): /var/cache/dnf (sharing=locked)",
          "docUrl": "https://github.com/wharflab/tally/blob/main/docs/rules/tally/prefer-package-cache-mounts.md",
          "location": {
            "end": {
              "column": 0,
              "line": 8
            },
            "file": "testdata/prefer-package-cache-mounts/Dockerfile",
            "start": {
              "column": 0,
              "line": 8
            }
          },
          "message": "use cache mounts for package manager cache directories",
          "rule": "tally/prefer-package-cache-mounts",
          "severity": "info",
          "sourceCode": "RUN dnf install -y git \u0026\u0026 dnf clean all",
          "suggestedFix": {
            "description": "Add package cache mount(s) and remove cache cleanup commands",
            "edits": [
              {
                "location": {
                  "end": {
                    "column": 39,
                    "line": 8
                  },
                  "file": "testdata/prefer-package-cache-mounts/Dockerfile",
                  "start": {
                    "column": 0,
                    "line": 8
                  }
                },
                "newText": "RUN --mount=type=cache,target=/var/cache/dnf,sharing=locked dnf install -y git"
              }
            ],
            "priority": 90,
            "safety": 1
          }
        },
        {
          "detail": "Detected package install/build command; add cache mount(s): /var/cache/yum (sharing=locked)",
          "docUrl": "https://github.com/wharflab/tally/blob/main/docs/rules/tally/prefer-package-cache-mounts.md",
          "location": {
            "end": {
              "column": 0,
              "line": 9
            },
            "file": "testdata/prefer-package-cache-mounts/Dockerfile",
            "start": {
              "column": 0,
              "line": 9
            }
          },
          "message": "use cache mounts for package manager cache directories",
          "rule": "tally/prefer-package-cache-mounts",
          "severity": "info",
          "sourceCode": "RUN yum install -y make \u0026\u0026 yum clean all",
          "suggestedFix": {
            "description": "Add package cache mount(s) and remove cache cleanup commands",
            "edits": [
              {
                "location": {
                  "end": {
                    "column": 40,
                    "line": 9
                  },
                  "file": "testdata/prefer-package-cache-mounts/Dockerfile",
                  "start": {
                    "column": 0,
                    "line": 9
                  }
                },
                "newText": "RUN --mount=type=cache,target=/var/cache/yum,sharing=locked yum install -y make"
              }
            ],
            "priority": 90,
            "safety": 1
          }
        },
        {
          "detail": "Detected package install/build command; add cache mount(s): /root/.cache/pip",
          "docUrl": "https://github.com/wharflab/tally/blob/main/docs/rules/tally/prefer-package-cache-mounts.md",
          "location": {
            "end": {
              "column": 0,
              "line": 10
            },
            "file": "testdata/prefer-package-cache-mounts/Dockerfile",
            "start": {
              "column": 0,
              "line": 10
            }
          },
          "message": "use cache mounts for package manager cache directories",
          "rule": "tally/prefer-package-cache-mounts",
          "severity": "info",
          "sourceCode": "RUN pip install --no-cache-dir -r requirements.txt \u0026\u0026 pip cache purge",
          "suggestedFix": {
            "description": "Add package cache mount(s) and remove cache cleanup commands",
            "edits": [
              {
                "location": {
                  "end": {
                    "column": 69,
                    "line": 10
                  },
                  "file": "testdata/prefer-package-cache-mounts/Dockerfile",
                  "start": {
                    "column": 0,
                    "line": 10
                  }
                },
                "newText": "RUN --mount=type=cache,target=/root/.cache/pip pip install -r requirements.txt"
              }
            ],
            "priority": 90,
            "safety": 1
          }
        },
        {
          "detail": "Detected package install/build command; add cache mount(s): /root/.gem",
          "docUrl": "https://github.com/wharflab/tally/blob/main/docs/rules/tally/prefer-package-cache-mounts.md",
          "location": {
            "end": {
              "column": 0,
              "line": 11
            },
            "file": "testdata/prefer-package-cache-mounts/Dockerfile",
            "start": {
              "column": 0,
              "line": 11
            }
          },
          "message": "use cache mounts for package manager cache directories",
          "rule": "tally/prefer-package-cache-mounts",
          "severity": "info",
          "sourceCode": "RUN bundle install \u0026\u0026 bundle clean",
          "suggestedFix": {
            "description": "Add package cache mount(s) and remove cache cleanup commands",
            "edits": [
              {
                "location": {
                  "end": {
                    "column": 34,
                    "line": 11
                  },
                  "file": "testdata/prefer-package-cache-mounts/Dockerfile",
                  "start": {
                    "column": 0,
                    "line": 11
                  }
                },
                "newText": "RUN --mount=type=cache,target=/root/.gem bundle install"
              }
            ],
            "priority": 90,
            "safety": 1
          }
        },
        {
          "detail": "Detected package install/build command; add cache mount(s): /app/target, /usr/local/cargo/git/db, /usr/local/cargo/registry",
          "docUrl": "https://github.com/wharflab/tally/blob/main/docs/rules/tally/prefer-package-cache-mounts.md",
          "location": {
            "end": {
              "column": 0,
              "line": 12
            },
            "file": "testdata/prefer-package-cache-mounts/Dockerfile",
            "start": {
              "column": 0,
              "line": 12
            }
          },
          "message": "use cache mounts for package manager cache directories",
          "rule": "tally/prefer-package-cache-mounts",
          "severity": "info",
          "sourceCode": "RUN cargo build --release",
          "suggestedFix": {
            "description": "Add package cache mount(s)",
            "edits": [
              {
                "location": {
                  "end": {
                    "column": 25,
                    "line": 12
                  },
                  "file": "testdata/prefer-package-cache-mounts/Dockerfile",
                  "start": {
                    "column": 0,
                    "line": 12
                  }
                },
                "newText": "RUN --mount=type=cache,target=/app/target --mount=type=cache,target=/usr/local/cargo/git/db --mount=type=cache,target=/usr/local/cargo/registry cargo build --release"
              }
            ],
            "priority": 90,
            "safety": 1
          }
        },
        {
          "detail": "Detected package install/build command; add cache mount(s): /root/.nuget/packages",
          "docUrl": "https://github.com/wharflab/tally/blob/main/docs/rules/tally/prefer-package-cache-mounts.md",
          "location": {
            "end": {
              "column": 0,
              "line": 13
            },
            "file": "testdata/prefer-package-cache-mounts/Dockerfile",
            "start": {
              "column": 0,
              "line": 13
            }
          },
          "message": "use cache mounts for package manager cache directories",
          "rule": "tally/prefer-package-cache-mounts",
          "severity": "info",
          "sourceCode": "RUN dotnet restore \u0026\u0026 dotnet nuget locals all --clear",
          "suggestedFix": {
            "description": "Add package cache mount(s) and remove cache cleanup commands",
            "edits": [
              {
                "location": {
                  "end": {
                    "column": 53,
                    "line": 13
                  },
                  "file": "testdata/prefer-package-cache-mounts/Dockerfile",
                  "start": {
                    "column": 0,
                    "line": 13
                  }
                },
                "newText": "RUN --mount=type=cache,target=/root/.nuget/packages dotnet restore"
              }
            ],
            "priority": 90,
            "safety": 1
          }
        },
        {
          "detail": "Detected package install/build command; add cache mount(s): /tmp/cache",
          "docUrl": "https://github.com/wharflab/tally/blob/main/docs/rules/tally/prefer-package-cache-mounts.md",
          "location": {
            "end": {
              "column": 0,
              "line": 14
            },
            "file": "testdata/prefer-package-cache-mounts/Dockerfile",
            "start": {
              "column": 0,
              "line": 14
            }
          },
          "message": "use cache mounts for package manager cache directories",
          "rule": "tally/prefer-package-cache-mounts",
          "severity": "info",
          "sourceCode": "RUN composer install --no-dev \u0026\u0026 composer clear-cache",
          "suggestedFix": {
            "description": "Add package cache mount(s) and remove cache cleanup commands",
            "edits": [
              {
                "location": {
                  "end": {
                    "column": 53,
                    "line": 14
                  },
                  "file": "testdata/prefer-package-cache-mounts/Dockerfile",
                  "start": {
                    "column": 0,
                    "line": 14
                  }
                },
                "newText": "RUN --mount=type=cache,target=/tmp/cache composer install --no-dev"
              }
            ],
            "priority": 90,
            "safety": 1
          }
        },
        {
          "detail": "Detected package install/build command; add cache mount(s): /root/.cache/uv",
          "docUrl": "https://github.com/wharflab/tally/blob/main/docs/rules/tally/prefer-package-cache-mounts.md",
          "location": {
            "end": {
              "column": 0,
              "line": 15
            },
            "file": "testdata/prefer-package-cache-mounts/Dockerfile",
            "start": {
              "column": 0,
              "line": 15
            }
          },
          "message": "use cache mounts for package manager cache directories",
          "rule": "tally/prefer-package-cache-mounts",
          "severity": "info",
          "sourceCode": "RUN uv sync --no-cache --frozen \u0026\u0026 uv cache clean",
          "suggestedFix": {
            "description": "Add package cache mount(s) and remove cache cleanup commands",
            "edits": [
              {
                "location": {
                  "end": {
                    "column": 49,
                    "line": 15
                  },
                  "file": "testdata/prefer-package-cache-mounts/Dockerfile",
                  "start": {
                    "column": 0,
                    "line": 15
                  }
                },
                "newText": "RUN --mount=type=cache,target=/root/.cache/uv uv sync --frozen"
              }
            ],
            "priority": 90,
            "safety": 1
          }
        },
        {
          "detail": "Detected package install/build command; add cache mount(s): /root/.bun/install/cache",
          "docUrl": "https://github.com/wharflab/tally/blob/main/docs/rules/tally/prefer-package-cache-mounts.md",
          "location": {
            "end": {
              "column": 0,
              "line": 16
            },
            "file": "testdata/prefer-package-cache-mounts/Dockerfile",
            "start": {
              "column": 0,
              "line": 16
            }
          },
          "message": "use cache mounts for package manager cache directories",
          "rule": "tally/prefer-package-cache-mounts",
          "severity": "info",
          "sourceCode": "RUN bun install --no-cache \u0026\u0026 bun pm cache rm",
          "suggestedFix": {
            "description": "Add package cache mount(s) and remove cache cleanup commands",
            "edits": [
              {
                "location": {
                  "end": {
                    "column": 45,
                    "line": 16
                  },
                  "file": "testdata/prefer-package-cache-mounts/Dockerfile",
                  "start": {
                    "column": 0,
                    "line": 16
                  }
                },
                "newText": "RUN --mount=type=cache,target=/root/.bun/install/cache bun install"
              }
            ],
            "priority": 90,
            "safety": 1
          }
        },
        {
          "detail": "Detected package install/build command; add cache mount(s): /root/.npm",
          "docUrl": "https://github.com/wharflab/tally/blob/main/docs/rules/tally/prefer-package-cache-mounts.md",
          "location": {
            "end": {
              "column": 0,
              "line": 17
            },
            "file": "testdata/prefer-package-cache-mounts/Dockerfile",
            "start": {
              "column": 0,
              "line": 17
            }
          },
          "message": "use cache mounts for package manager cache directories",
          "rule": "tally/prefer-package-cache-mounts",
          "severity": "info",
          "sourceCode": "RUN \u003c\u003cEOF",
          "suggestedFix": {
            "description": "Add package cache mount(s) and remove cache cleanup commands",
            "edits": [
              {
                "location": {
                  "end": {
                    "column": 3,
                    "line": 20
                  },
                  "file": "testdata/prefer-package-cache-mounts/Dockerfile",
                  "start": {
                    "column": 0,
                    "line": 17
                  }
                },
                "newText": "RUN --mount=type=cache,target=/root/.npm \u003c\u003cEOF\nnpm install\nEOF"
              }
            ],
            "priority": 90,
            "safety": 1
          }
        }
      ]
    }
  ],
  "files_scanned": 1,
  "rules_enabled": 1,
  "summary": {
    "errors": 0,
    "files": 1,
    "info": 13,
    "style": 0,
    "total": 13,
    "warnings": 0
  }
}